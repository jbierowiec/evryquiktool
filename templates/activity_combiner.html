{% extends "base.html" %} {% block content %}
<h3 class="mb-3">Combine Activities (GPX / FIT)</h3>

<p class="text-muted">
  Upload multiple <strong>GPX</strong> and/or <strong>FIT</strong> files (e.g.,
  from Strava or AllTrails). We’ll merge them into a single activity you can
  download. The file is also saved under
  <strong>Downloads → Activities → Combine</strong> for later access.
</p>

<form method="post" enctype="multipart/form-data" id="activityCombinerForm">
  <div class="mb-3">
    <label for="tracks" class="form-label">Activity files</label>
    <input
      type="file"
      class="form-control"
      id="tracks"
      name="tracks"
      accept=".gpx,.fit"
      multiple
      required
    />
    <div class="form-text">
      You can mix GPX and FIT files; we’ll merge them in the order selected.
    </div>
  </div>

  <div class="mb-3">
    <label for="output_name" class="form-label">Output file name</label>
    <input
      type="text"
      class="form-control"
      id="output_name"
      name="output_name"
      placeholder="combined_activity.gpx or combined_activity.fit"
      required
    />
    <div class="form-text">
      Leave off the extension if you want—we’ll add <code>.gpx</code> or
      <code>.fit</code> for you.
    </div>
  </div>

  <div class="mb-3">
    <label for="format" class="form-label">Format</label>
    <select class="form-select" id="format" name="format">
      <option value="gpx" selected>GPX</option>
      <option value="fit">FIT</option>
    </select>
  </div>

  <button class="btn btn-primary" type="submit">Download Combined File</button>
</form>

<hr class="my-4" />

<!-- New: View on Map card -->
<div class="card">
  <div class="card-body d-flex align-items-center justify-content-between">
    <div>
      <h5 class="card-title mb-1">Preview Combined Route</h5>
      {% if latest_combined %}
      <p class="text-muted mb-0">
        Latest file detected: <code>{{ latest_combined }}</code>
      </p>
      {% else %}
      <p class="text-muted mb-0">
        No combined GPX found yet. Create one to enable the map preview.
      </p>
      {% endif %}
    </div>

    {% if latest_combined %}
    <a
      class="btn btn-success"
      href="{{ url_for('view_combined_route', filename=latest_combined) }}"
    >
      View on Map
    </a>
    {% else %}
    <button class="btn btn-success" disabled>View on Map</button>
    {% endif %}
  </div>
</div>

<div class="small text-muted">
  Make sure you have the rights to use the files you upload. Some platforms have
  specific terms; please respect them.
</div>
{% endblock %}
